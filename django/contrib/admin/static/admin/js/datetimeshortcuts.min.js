(function(c){c.fn.datetimeshortcuts=function(v){var w=c("body").data("datetimeshortcuts_defaults"),b=c.extend({admin_media_prefix:c("body").data("admin_media_prefix")},c.fn.datetimeshortcuts.defaults,w,v);void 0===b.admin_media_prefix&&(b.admin_media_prefix="/missing-admin-media-prefix/");var x=gettext("January February March April May June July August September October November December").split(" "),y=gettext("S M T W T F S").split(" "),u=parseInt(get_format("FIRST_DAY_OF_WEEK"),10),t=function(b,
q){var a,e,h;null!==b&&(a=b.getFullYear(),e=b.getMonth(),h=b.getDate());for(var f=q.getFullYear(),j=q.getMonth(),g=new Date,k=g.getFullYear(),m=g.getMonth(),g=g.getDate(),l=c("<table><caption>"+x[j]+" "+f+"</caption></table>"),n=c("<tr>").appendTo(l),p=0;7>p;p++)n.append("<th>"+y[(p+u)%7]+"</th>");for(var r=(new Date(f,j,1-u)).getDay(),t=32-(new Date(f,j,32)).getDate(),n=c("<tr>").appendTo(l),p=0;p<r;p++)c("<td> </td>").appendTo(n).addClass("nonday");for(var s=1,p=r;s<=t;p++)0===p%7&&1!=s&&(n=c("<tr>").appendTo(l)),
r="",s==g&&(j==m&&f==k)&&(r="today"),s==h&&(j==e&&f==a)&&(r="selected"),c("<td>").appendTo(n).addClass(r).append('<a href="#">'+s+"</a>").find("a").data("date",new Date(f,j,s++));for(;7>n.children("td").length;)c("<td> </td>").appendTo(n).addClass("nonday");return l};return this.each(function(){var d=c(this);d.bind({"show_calendar.datetimeshortcuts":function(a){d.trigger("hide_clock");d.trigger("hide_calendar");a=c(a.target);var e=d.children("."+b.class_calendarbox),h=a.parents("."+b.class_shortcuts).prev(b.date_fields),
f=null,j=new Date;if(0<h.val().length){for(var g=b.date_input_format,k={Y:"(\\d{4})",y:"(\\d{2})",m:"(\\d{2})",d:"(\\d{2})","%":"%"},m="",l="",n,g=g.replace(RegExp("([.^$*+?(){}[]|])","g"),"$&");-1!==g.indexOf("%");)n=g.indexOf("%")+1,l=l+g.substr(0,n-1)+k[g[n]],m+=g[n],g=g.substr(n+1);g=RegExp("^"+l+"$");if(-1!==m.toLowerCase().indexOf("y")&&-1!==m.indexOf("m")){g=g.exec(h.val());k=m.indexOf("Y");-1!==k?k=parseInt(g[k+1],10):(k=m.indexOf("y"),k=parseInt(g[k+1],10),k=68>=k?k+2E3:k+1900);l=parseInt(g[m.indexOf("m")+
1],10);if(1>l||12<l)l=void 0;m=parseInt(g[m.indexOf("d")+1],10);k&&(l&&m)&&(f=new Date(k,l-1,m),j=new Date(k,l-1,m))}}e.data("calendar_date_field",h).data("calendar_date_show",j).data("calendar_date_sel",f).find(".calendar_table").empty().append(t(f,j)).end().show();h=a.position();f=c("body").attr("direction");"rtl"!=f&&e.css("left",h.left+a.width()+"px");("rtl"==f||e.offset().left+e.width()>c(window).width())&&e.css("left",h.left-e.width()+"px");e.css("top",Math.max(0,h.top-e.height()/2)+"px");c("body").bind({"click.datetimeshortcuts":function(){d.trigger("hide_calendar.datetimeshortcuts")},
"keyup.datetimeshortcuts":function(a){27==a.which&&(d.trigger("hide_calendar.datetimeshortcuts"),a.preventDefault())}})},"calendar_next.datetimeshortcuts":function(a){a=c(a.target);var b=a.find(".calendar_table").empty(),d=a.data("calendar_date_sel"),f=a.data("calendar_date_show"),j=f.getMonth(),g=f.getFullYear();11==j?(j=0,g++):j++;f.setFullYear(g,j,1);a.data("calendar_date_show",f);b.append(t(d,f))},"calendar_previous.datetimeshortcuts":function(a){a=c(a.target);var b=a.find(".calendar_table").empty(),
d=a.data("calendar_date_sel"),f=a.data("calendar_date_show"),j=f.getMonth(),g=f.getFullYear();0===j?(j=11,g--):j--;f.setFullYear(g,j,1);a.data("calendar_date_show",f);b.append(t(d,f))},"hide_calendar.datetimeshortcuts":function(a){c(a.target).children("."+b.class_calendarbox).removeData("calendar_date_field").removeData("calendar_date_sel").removeData("calendar_date_show").hide();c("document").unbind(".datetimeshortcuts")},"show_clock.datetimeshortcuts":function(a){d.trigger("hide_clock.datetimeshortcuts");
d.trigger("hide_calendar.datetimeshortcuts");a=c(a.target);var e=d.children("."+b.class_clockbox),h=a.parents("."+b.class_shortcuts).prev(b.time_fields);e.data("clock_time_field",h).show();var h=a.position(),f=c("body").attr("direction");"rtl"!=f&&e.css("left",h.left+a.width()+"px");("rtl"==f||e.offset().left+e.width()>c(window).width())&&e.css("left",h.left-e.width()+"px");e.css("top",Math.max(0,h.top-e.height()/2)+"px");c("body").bind({"click.datetimeshortcuts":function(){d.trigger("hide_clock.datetimeshortcuts")},
"keyup.datetimeshortcuts":function(a){27==a.which&&(d.trigger("hide_clock.datetimeshortcuts"),a.preventDefault())}})},"hide_clock.datetimeshortcuts":function(a){c(a.target).children("."+b.class_clockbox).removeData("clock_time_field").hide();c("document").unbind(".datetimeshortcuts")},"callback_calendar.datetimeshortcuts":function(a,e){c(a.target).find("."+b.class_calendarbox).data("calendar_date_field").val(e.strftime(b.date_input_format)).focus();d.trigger("hide_calendar.datetimeshortcuts")},"callback_today.datetimeshortcuts":function(a,
e){var d=new Date;d.setDate(d.getDate()+e);c(a.target).val(d.strftime(b.date_input_format)).focus()},"callback_clock.datetimeshortcuts":function(a,e){c(a.target).find("."+b.class_clockbox).data("clock_time_field").val(e.strftime(b.time_input_format)).focus();d.trigger("hide_clock.datetimeshortcuts")},"callback_now.datetimeshortcuts":function(a){var d=new Date;c(a.target).val(d.strftime(b.time_input_format)).focus()}});d.find(b.date_fields).each(function(){var a=c(this),a=c('<span class="'+b.class_shortcuts+
'">').insertAfter(a);b.enable_today&&(a.append(' <a href="#" class="'+b.class_today+'">'+gettext("Today")+"</a>"),b.enable_calendar&&a.append(" | "));b.enable_calendar&&c('<a href="#" class="'+b.class_calendar+'"></a>').appendTo(a).append('<img src="'+b.admin_media_prefix+'img/icon_calendar.gif" alt="'+gettext("Calendar")+'" />')});d.find(b.time_fields).each(function(){var a=c(this),a=c('<span class="'+b.class_shortcuts+'">').insertAfter(a);b.enable_now&&(a.append(' <a href="#" class="'+b.class_now+
'">'+gettext("Now")+"</a>"),b.enable_clock&&a.append(" | "));b.enable_clock&&c('<a href="#" class="'+b.class_clock+'"></a>').appendTo(a).append('<img src="'+b.admin_media_prefix+'img/icon_clock.gif" alt="'+gettext("Clock")+'" />')});0===d.find("."+b.class_calendarbox).length&&(c('<div class="'+b.class_calendarbox+' module">  <div>    <a href="#" class="calendarnav-previous"><</a>    <a href="#" class="calendarnav-next">></a>  </div>  <div class="calendar_table calendar"></div>  <div class="calendar-shortcuts">    <a href="#" class="'+
b.class_today+' yesterday">'+gettext("Yesterday")+'</a> |\u00a0<a href="#" class="'+b.class_today+'">'+gettext("Today")+'</a> |\u00a0<a href="#" class="'+b.class_today+' tomorrow">'+gettext("Tomorrow")+'</a>  </div>  <p class="calendar-cancel"><a href="#">'+gettext("Cancel")+"</p></div>").appendTo(d).css("position","absolute").hide(),d.find("."+b.class_calendarbox).delegate(".calendarnav-previous, .calendarnav-next","click",function(a){var d=c(this).is(".calendarnav-next")?"calendar_next":"calendar_previous";
c(this).parents("."+b.class_calendarbox).trigger(d);a.preventDefault();a.stopPropagation()}).delegate("td a","click",function(a){d.trigger("callback_calendar",c(a.target).data("date"));a.preventDefault();a.stopPropagation()}).find(".calendar-cancel").click(function(a){d.trigger("hide_calendar");a.preventDefault();a.stopPropagation()}));if(0===d.find("."+b.class_clockbox).length){var q=c('<div class="'+b.class_clockbox+' module">  <h2>'+gettext("Choose a time")+'</h2>  <ul class="timelist"></ul>  <p class="clock-cancel"><a href="#">'+
gettext("Cancel")+"</p></div>").appendTo(d).css("position","absolute").hide().find(".timelist");q.append('<li><a href="#">'+gettext("Now")+"</a></li>").find("a:last").data("time",new Date);q.append('<li><a href="#">'+gettext("Midnight")+"</a></li>").find("a:last").data("time",new Date(1970,1,1,0,0));q.append('<li><a href="#">'+gettext("6 a.m.")+"</a></li>").find("a:last").data("time",new Date(1970,1,1,6,0));q.append('<li><a href="#">'+gettext("Noon")+"</a></li>").find("a:last").data("time",new Date(1970,
1,1,12,0));d.find("."+b.class_clockbox).delegate("li a","click",function(a){d.trigger("callback_clock",c(a.target).data("time"));a.preventDefault();a.stopPropagation()}).find(".clock-cancel").click(function(a){d.trigger("hide_clock");a.preventDefault();a.stopPropagation()})}d.delegate("."+b.class_shortcuts+" ."+b.class_calendar,"click.datetimeshortcuts",function(a){c(a.target).trigger("show_calendar.datetimeshortcuts");a.preventDefault();a.stopPropagation()}).delegate("."+b.class_shortcuts+" ."+b.class_today,
"click.datetimeshortcuts",function(a){c(a.target).parents("."+b.class_shortcuts).prev(b.date_fields).trigger("callback_today.datetimeshortcuts",0);d.trigger("hide_calendar.datetimeshortcuts");a.preventDefault();a.stopPropagation()}).delegate("."+b.class_calendarbox+" ."+b.class_today,"click.datetimeshortcuts",function(a){var e=c(a.target),h=0;e.is(".yesterday")?h=-1:e.is(".tomorrow")&&(h=1);e.parents("."+b.class_calendarbox).data("calendar_date_field").trigger("callback_today.datetimeshortcuts",h).focus();
d.trigger("hide_calendar.datetimeshortcuts");a.preventDefault();a.stopPropagation()}).delegate("."+b.class_shortcuts+" ."+b.class_clock,"click.datetimeshortcuts",function(a){c(a.target).trigger("show_clock.datetimeshortcuts");a.preventDefault();a.stopPropagation()}).delegate("."+b.class_shortcuts+" ."+b.class_now,"click.datetimeshortcuts",function(a){c(a.target).parents("."+b.class_shortcuts).prev(b.time_fields).trigger("callback_now.datetimeshortcuts");d.trigger("hide_clock.datetimeshortcuts");a.preventDefault();
a.stopPropagation()})})};c.fn.datetimeshortcuts.defaults={class_shortcuts:"datetimeshortcuts",class_today:"today",class_calendar:"calendar",class_now:"now",class_clock:"clock",class_calendarbox:"calendarbox",class_clockbox:"clockbox",date_input_format:get_format("DATE_INPUT_FORMATS")[0],time_input_format:get_format("TIME_INPUT_FORMATS")[0],date_fields:"input:text.vDateField",time_fields:"input:text.vTimeField",enable_calendar:!0,enable_today:!0,enable_clock:!0,enable_now:!0};c(document).ready(function(){c("fieldset.module").datetimeshortcuts()})})(django.jQuery);
